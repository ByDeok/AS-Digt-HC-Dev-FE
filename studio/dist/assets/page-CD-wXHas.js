import{a as y,r as i,h as Fe,j as t,b as Ae,P as E,d as N,f as L,u as W,z as _e,e as Te,Y as ke,i as G,C as De,n as Le,o as Ge,s as Me,k as Oe,l as $e,p as Ve,B}from"./index-ClgdERjX.js";import{I as z}from"./input-DrzNnfUm.js";import{L as w}from"./label-BJHdrC9w.js";import{u as J}from"./index-CeNByP9b.js";import{u as Ke,C as Ue}from"./checkbox-uuztJN3a.js";import{C as Be}from"./circle-DrZMzmQ0.js";import{o as _}from"./onboardingService-CRo2chzl.js";import{a as q}from"./api-DZjyy_ef.js";import{u as H}from"./common-nrhy01Dw.js";import"./check-d_h6IF2e.js";var T="rovingFocusGroup.onEntryFocus",ze={bubbles:!1,cancelable:!0},P="RovingFocusGroup",[k,Q,qe]=Fe(P),[He,Z]=y(P,[qe]),[Ye,Xe]=He(P),ee=i.forwardRef((e,o)=>t.jsx(k.Provider,{scope:e.__scopeRovingFocusGroup,children:t.jsx(k.Slot,{scope:e.__scopeRovingFocusGroup,children:t.jsx(We,{...e,ref:o})})}));ee.displayName=P;var We=i.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:r,orientation:a,loop:n=!1,dir:d,currentTabStopId:m,defaultCurrentTabStopId:p,onCurrentTabStopIdChange:l,onEntryFocus:f,preventScrollOnEntryFocus:g=!1,...h}=e,s=i.useRef(null),u=L(o,s),c=J(d),[v=null,b]=W({prop:m,defaultProp:p,onChange:l}),[R,I]=i.useState(!1),S=_e(f),we=Q(r),F=i.useRef(!1),[Ee,K]=i.useState(0);return i.useEffect(()=>{const x=s.current;if(x)return x.addEventListener(T,S),()=>x.removeEventListener(T,S)},[S]),t.jsx(Ye,{scope:r,orientation:a,dir:c,loop:n,currentTabStopId:v,onItemFocus:i.useCallback(x=>b(x),[b]),onItemShiftTab:i.useCallback(()=>I(!0),[]),onFocusableItemAdd:i.useCallback(()=>K(x=>x+1),[]),onFocusableItemRemove:i.useCallback(()=>K(x=>x-1),[]),children:t.jsx(E.div,{tabIndex:R||Ee===0?-1:0,"data-orientation":a,...h,ref:u,style:{outline:"none",...e.style},onMouseDown:N(e.onMouseDown,()=>{F.current=!0}),onFocus:N(e.onFocus,x=>{const je=!F.current;if(x.target===x.currentTarget&&je&&!R){const U=new CustomEvent(T,ze);if(x.currentTarget.dispatchEvent(U),!U.defaultPrevented){const A=we().filter(C=>C.focusable),ye=A.find(C=>C.active),Pe=A.find(C=>C.id===v),Se=[ye,Pe,...A].filter(Boolean).map(C=>C.ref.current);oe(Se,g)}}F.current=!1}),onBlur:N(e.onBlur,()=>I(!1))})})}),te="RovingFocusGroupItem",re=i.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:r,focusable:a=!0,active:n=!1,tabStopId:d,...m}=e,p=Ae(),l=d||p,f=Xe(te,r),g=f.currentTabStopId===l,h=Q(r),{onFocusableItemAdd:s,onFocusableItemRemove:u}=f;return i.useEffect(()=>{if(a)return s(),()=>u()},[a,s,u]),t.jsx(k.ItemSlot,{scope:r,id:l,focusable:a,active:n,children:t.jsx(E.span,{tabIndex:g?0:-1,"data-orientation":f.orientation,...m,ref:o,onMouseDown:N(e.onMouseDown,c=>{a?f.onItemFocus(l):c.preventDefault()}),onFocus:N(e.onFocus,()=>f.onItemFocus(l)),onKeyDown:N(e.onKeyDown,c=>{if(c.key==="Tab"&&c.shiftKey){f.onItemShiftTab();return}if(c.target!==c.currentTarget)return;const v=Ze(c,f.orientation,f.dir);if(v!==void 0){if(c.metaKey||c.ctrlKey||c.altKey||c.shiftKey)return;c.preventDefault();let R=h().filter(I=>I.focusable).map(I=>I.ref.current);if(v==="last")R.reverse();else if(v==="prev"||v==="next"){v==="prev"&&R.reverse();const I=R.indexOf(c.currentTarget);R=f.loop?et(R,I+1):R.slice(I+1)}setTimeout(()=>oe(R))}})})})});re.displayName=te;var Je={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Qe(e,o){return o!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Ze(e,o,r){const a=Qe(e.key,r);if(!(o==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(o==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return Je[a]}function oe(e,o=!1){const r=document.activeElement;for(const a of e)if(a===r||(a.focus({preventScroll:o}),document.activeElement!==r))return}function et(e,o){return e.map((r,a)=>e[(o+a)%e.length])}var tt=ee,rt=re,M="Radio",[ot,ae]=y(M),[at,st]=ot(M),se=i.forwardRef((e,o)=>{const{__scopeRadio:r,name:a,checked:n=!1,required:d,disabled:m,value:p="on",onCheck:l,form:f,...g}=e,[h,s]=i.useState(null),u=L(o,b=>s(b)),c=i.useRef(!1),v=h?f||!!h.closest("form"):!0;return t.jsxs(at,{scope:r,checked:n,disabled:m,children:[t.jsx(E.button,{type:"button",role:"radio","aria-checked":n,"data-state":ce(n),"data-disabled":m?"":void 0,disabled:m,value:p,...g,ref:u,onClick:N(e.onClick,b=>{n||l==null||l(),v&&(c.current=b.isPropagationStopped(),c.current||b.stopPropagation())})}),v&&t.jsx(nt,{control:h,bubbles:!c.current,name:a,value:p,checked:n,required:d,disabled:m,form:f,style:{transform:"translateX(-100%)"}})]})});se.displayName=M;var ne="RadioIndicator",ie=i.forwardRef((e,o)=>{const{__scopeRadio:r,forceMount:a,...n}=e,d=st(ne,r);return t.jsx(Te,{present:a||d.checked,children:t.jsx(E.span,{"data-state":ce(d.checked),"data-disabled":d.disabled?"":void 0,...n,ref:o})})});ie.displayName=ne;var nt=e=>{const{control:o,checked:r,bubbles:a=!0,...n}=e,d=i.useRef(null),m=Ke(r),p=ke(o);return i.useEffect(()=>{const l=d.current,f=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(f,"checked").set;if(m!==r&&h){const s=new Event("click",{bubbles:a});h.call(l,r),l.dispatchEvent(s)}},[m,r,a]),t.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:d,style:{...e.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function ce(e){return e?"checked":"unchecked"}var it=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],O="RadioGroup",[ct]=y(O,[Z,ae]),le=Z(),de=ae(),[lt,dt]=ct(O),ue=i.forwardRef((e,o)=>{const{__scopeRadioGroup:r,name:a,defaultValue:n,value:d,required:m=!1,disabled:p=!1,orientation:l,dir:f,loop:g=!0,onValueChange:h,...s}=e,u=le(r),c=J(f),[v,b]=W({prop:d,defaultProp:n,onChange:h});return t.jsx(lt,{scope:r,name:a,required:m,disabled:p,value:v,onValueChange:b,children:t.jsx(tt,{asChild:!0,...u,orientation:l,dir:c,loop:g,children:t.jsx(E.div,{role:"radiogroup","aria-required":m,"aria-orientation":l,"data-disabled":p?"":void 0,dir:c,...s,ref:o})})})});ue.displayName=O;var fe="RadioGroupItem",pe=i.forwardRef((e,o)=>{const{__scopeRadioGroup:r,disabled:a,...n}=e,d=dt(fe,r),m=d.disabled||a,p=le(r),l=de(r),f=i.useRef(null),g=L(o,f),h=d.value===n.value,s=i.useRef(!1);return i.useEffect(()=>{const u=v=>{it.includes(v.key)&&(s.current=!0)},c=()=>s.current=!1;return document.addEventListener("keydown",u),document.addEventListener("keyup",c),()=>{document.removeEventListener("keydown",u),document.removeEventListener("keyup",c)}},[]),t.jsx(rt,{asChild:!0,...p,focusable:!m,active:h,children:t.jsx(se,{disabled:m,required:d.required,checked:h,...l,...n,name:d.name,ref:g,onCheck:()=>d.onValueChange(n.value),onKeyDown:N(u=>{u.key==="Enter"&&u.preventDefault()}),onFocus:N(n.onFocus,()=>{var u;s.current&&((u=f.current)==null||u.click())})})})});pe.displayName=fe;var ut="RadioGroupIndicator",me=i.forwardRef((e,o)=>{const{__scopeRadioGroup:r,...a}=e,n=de(r);return t.jsx(ie,{...n,...a,ref:o})});me.displayName=ut;var ve=ue,he=pe,ft=me;const xe=i.forwardRef(({className:e,...o},r)=>t.jsx(ve,{className:G("grid gap-2",e),...o,ref:r}));xe.displayName=ve.displayName;const D=i.forwardRef(({className:e,...o},r)=>t.jsx(he,{ref:r,className:G("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...o,children:t.jsx(ft,{className:"flex items-center justify-center",children:t.jsx(Be,{className:"h-2.5 w-2.5 fill-current text-current"})})}));D.displayName=he.displayName;var $="Progress",V=100,[pt]=y($),[mt,vt]=pt($),ge=i.forwardRef((e,o)=>{const{__scopeProgress:r,value:a=null,max:n,getValueLabel:d=ht,...m}=e;(n||n===0)&&!Y(n)&&console.error(xt(`${n}`,"Progress"));const p=Y(n)?n:V;a!==null&&!X(a,p)&&console.error(gt(`${a}`,"Progress"));const l=X(a,p)?a:null,f=j(l)?d(l,p):void 0;return t.jsx(mt,{scope:r,value:l,max:p,children:t.jsx(E.div,{"aria-valuemax":p,"aria-valuemin":0,"aria-valuenow":j(l)?l:void 0,"aria-valuetext":f,role:"progressbar","data-state":Ie(l,p),"data-value":l??void 0,"data-max":p,...m,ref:o})})});ge.displayName=$;var be="ProgressIndicator",Re=i.forwardRef((e,o)=>{const{__scopeProgress:r,...a}=e,n=vt(be,r);return t.jsx(E.div,{"data-state":Ie(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...a,ref:o})});Re.displayName=be;function ht(e,o){return`${Math.round(e/o*100)}%`}function Ie(e,o){return e==null?"indeterminate":e===o?"complete":"loading"}function j(e){return typeof e=="number"}function Y(e){return j(e)&&!isNaN(e)&&e>0}function X(e,o){return j(e)&&!isNaN(e)&&e<=o&&e>=0}function xt(e,o){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${o}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${V}\`.`}function gt(e,o){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${o}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${V} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Ne=ge,bt=Re;const Ce=i.forwardRef(({className:e,value:o,...r},a)=>t.jsx(Ne,{ref:a,className:G("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...r,children:t.jsx(bt,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(o||0)}%)`}})}));Ce.displayName=Ne.displayName;function Rt({title:e,description:o,progress:r,children:a,footer:n}){return t.jsxs(De,{className:"w-full max-w-md mx-auto",children:[t.jsxs(Le,{children:[t.jsx(Ce,{value:r,className:"mb-4 h-2"}),t.jsx(Ge,{children:e}),o&&t.jsx(Me,{children:o})]}),t.jsxs(Oe,{children:[t.jsx("div",{className:"space-y-6",children:a}),n&&t.jsx("div",{className:"mt-8 flex gap-4",children:n})]})]})}const It={getMe:async()=>{const e=await q.get("/v1/users/me");return H(e,"내 프로필을 불러오지 못했습니다.")},updateMe:async e=>{const o=await q.put("/v1/users/me",e);return H(o,"프로필 저장에 실패했습니다.")}},Nt=["고혈압","당뇨","고지혈증","관절염"];function kt(){const[e,o]=i.useState("name"),[r,a]=i.useState({name:"",birthdate:"",gender:"",conditions:[]}),n=$e(),{toast:d}=Ve();i.useEffect(()=>{_.start().catch(()=>{})},[]);const m=s=>/^\d{8}$/.test(s)?`${s.slice(0,4)}-${s.slice(4,6)}-${s.slice(6,8)}`:null,p=async()=>{if(e==="name"){o("birthdate");return}if(e==="birthdate"){const s=m(r.birthdate);if(!r.name.trim()){d({title:"입력 필요",description:"이름을 입력해주세요.",variant:"destructive"});return}if(!s){d({title:"입력 오류",description:"생년월일 8자리(예: 19501024)를 입력해주세요.",variant:"destructive"});return}const u=r.gender==="male"?"MALE":r.gender==="female"?"FEMALE":void 0;try{await _.step({currentStep:"PROFILE_BASIC",nextStep:"PROFILE_DETAILS",name:r.name.trim(),birthDate:s,gender:u})}catch{}o("conditions");return}if(e==="conditions"){const s=m(r.birthdate),u=r.gender==="male"?"MALE":r.gender==="female"?"FEMALE":void 0,c=JSON.stringify(r.conditions);try{await _.step({currentStep:"PROFILE_DETAILS",nextStep:"HOSPITAL_SELECTION",primaryConditions:c})}catch{}try{await It.updateMe({name:r.name.trim(),birthDate:s??void 0,gender:u??void 0,primaryConditions:c})}catch(v){const b=v instanceof Error?v.message:"프로필 저장에 실패했습니다.";d({title:"저장 실패",description:b,variant:"destructive"});return}n("/onboarding/device")}},l=()=>{e==="birthdate"?o("name"):e==="conditions"&&o("birthdate")},f=s=>{a(u=>({...u,conditions:u.conditions.includes(s)?u.conditions.filter(c=>c!==s):[...u.conditions,s]}))},g=e==="name"?33:e==="birthdate"?66:100,h=()=>{switch(e){case"name":return"이름을 알려주세요";case"birthdate":return"생년월일을 알려주세요";case"conditions":return"건강 정보를 알려주세요"}};return t.jsx(Rt,{title:h(),description:"맞춤 관리를 위해 필요해요.",progress:g,footer:t.jsxs(t.Fragment,{children:[e!=="name"&&t.jsx(B,{size:"xl",variant:"outline",onClick:l,className:"w-1/3",children:"이전"}),t.jsx(B,{size:"xl",onClick:p,className:"w-full",children:e==="conditions"?"거의 다 왔어요!":"다음"})]}),children:t.jsxs("div",{className:"space-y-6",children:[e==="name"&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{htmlFor:"name",className:"text-base",children:"이름"}),t.jsx(z,{id:"name",placeholder:"김철수",value:r.name,onChange:s=>a({...r,name:s.target.value}),autoComplete:"name"})]}),e==="birthdate"&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{htmlFor:"birthdate",className:"text-base",children:"생년월일 8자리"}),t.jsx(z,{id:"birthdate",placeholder:"19501024",value:r.birthdate,onChange:s=>a({...r,birthdate:s.target.value}),type:"tel",maxLength:8})]}),e==="conditions"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx(w,{className:"text-base",children:"성별"}),t.jsxs(xe,{defaultValue:r.gender,onValueChange:s=>a({...r,gender:s}),className:"flex gap-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(D,{value:"male",id:"male"}),t.jsx(w,{htmlFor:"male",className:"text-base",children:"남성"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(D,{value:"female",id:"female"}),t.jsx(w,{htmlFor:"female",className:"text-base",children:"여성"})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(w,{className:"text-base",children:"가지고 있는 질환을 모두 선택해주세요."}),t.jsx("div",{className:"grid grid-cols-2 gap-4",children:Nt.map(s=>t.jsxs("div",{className:"flex items-center space-x-3 rounded-md border p-4",children:[t.jsx(Ue,{id:s,checked:r.conditions.includes(s),onCheckedChange:()=>f(s)}),t.jsx(w,{htmlFor:s,className:"text-base font-normal",children:s})]},s))})]})]})]})})}export{kt as default};
