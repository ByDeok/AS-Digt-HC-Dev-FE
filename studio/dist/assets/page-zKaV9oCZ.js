import{c as B,v as A,p as H,r as j,j as e,x as Q,B as x,C as c}from"./index-ClgdERjX.js";import{u as z,a as T,P as F,S as K,L as _}from"./ListItem-BGvcul8-.js";import{a as u}from"./api-DZjyy_ef.js";import{u as p}from"./common-nrhy01Dw.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],O=B("Trash2",G),f={list:async s=>{const r=await u.get("/reports",{params:s?{periodType:s}:void 0});return p(r,"리포트를 불러오지 못했습니다.")},generate:async s=>{const r=await u.post("/reports/generate",void 0,{params:s?{periodType:s}:void 0});return p(r,"리포트 생성에 실패했습니다.")},getById:async s=>{const r=await u.get(`/reports/${s}`);return p(r,"리포트를 불러오지 못했습니다.")},delete:async s=>{const r=await u.delete(`/reports/${s}`);p(r,"리포트 삭제에 실패했습니다.")}},y={list:s=>["reports","list",s??"ALL"],detail:s=>["reports","detail",s]};function V(s){return z({queryKey:y.list(s),queryFn:()=>f.list(s)})}function J(s){const r=A();return T({mutationFn:()=>f.generate(s),onSuccess:i=>{r.setQueryData(y.list(s),n=>n?[i,...n]:[i])}})}function U(s){const r=A();return T({mutationFn:i=>f.delete(i),onSuccess:(i,n)=>{r.setQueryData(y.list(s),o=>o&&o.filter(h=>h.reportId!==n))}})}function Y(s){return`${s.startDate} ~ ${s.endDate}`}function te(){var b,I,E,L,w,k,C,P,M,R,S,D;const{toast:s}=H(),[r,i]=j.useState("WEEKLY"),{data:n=[],isLoading:o,isError:h}=V(r),g=J(r),N=U(r),[d,m]=j.useState(null),a=j.useMemo(()=>d?n.find(t=>t.reportId===d)||null:n[0]||null,[n,d]),W=async()=>{try{const t=await g.mutateAsync();m(t.reportId),s({title:"리포트 생성 완료",description:"새 리포트가 생성되었습니다."})}catch(t){const l=t instanceof Error?t.message:"리포트 생성에 실패했습니다.";s({title:"리포트 생성 실패",description:l,variant:"destructive"})}},v=()=>{i(t=>t==="WEEKLY"?"MONTHLY":"WEEKLY"),m(null)},$=async t=>{try{await N.mutateAsync(t),s({title:"삭제 완료",description:"리포트가 삭제되었습니다."}),d===t&&m(null)}catch(l){const q=l instanceof Error?l.message:"리포트 삭제에 실패했습니다.";s({title:"삭제 실패",description:q,variant:"destructive"})}};return o?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsx(Q,{})}):h?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsx("p",{className:"text-red-500",children:"리포트를 불러오는 중 오류가 발생했습니다."})}):e.jsxs("div",{className:"bg-gray-50 min-h-screen",children:[e.jsx(F,{title:"건강 리포트",rightContent:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:r==="WEEKLY"?"default":"outline",size:"sm",onClick:v,children:"주간"}),e.jsx(x,{variant:r==="MONTHLY"?"default":"outline",size:"sm",onClick:v,children:"월간"}),e.jsx(x,{onClick:W,disabled:g.isPending,children:g.isPending?"생성 중...":"리포트 생성"})]})}),e.jsxs("main",{className:"p-4 space-y-6 max-w-3xl mx-auto w-full",children:[e.jsx(K,{title:"리포트 목록",description:`${r==="WEEKLY"?"주간":"월간"} 리포트 목록입니다. 최근 생성된 리포트부터 표시됩니다.`,children:n.length===0?e.jsx(c,{className:"p-4 text-sm text-muted-foreground",children:"리포트가 없습니다. 생성해보세요."}):e.jsx("div",{className:"space-y-3",children:n.map(t=>e.jsx(_,{onClick:()=>m(t.reportId),className:(a==null?void 0:a.reportId)===t.reportId?"bg-primary/5 border-border":"bg-card",middle:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-semibold",children:Y(t)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["생성일: ",t.createdAt??"알 수 없음"," · Report ID: ",t.reportId]})]}),end:e.jsx(x,{variant:"ghost",size:"icon",onClick:l=>{l.stopPropagation(),$(t.reportId)},disabled:N.isPending,"aria-label":"리포트 삭제",children:e.jsx(O,{className:"w-4 h-4"})})},t.reportId))})}),e.jsx(K,{title:"리포트 상세",description:"선택한 리포트의 요약 지표입니다.",children:a?e.jsxs(c,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"기간"}),e.jsx("p",{className:"text-lg font-semibold",children:Y(a)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"생성일"}),e.jsx("p",{className:"text-sm",children:a.createdAt??"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(c,{className:"p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"걸음 수"}),e.jsx("p",{className:"font-semibold",children:((I=(b=a.metrics)==null?void 0:b.activity)==null?void 0:I.steps)??"-"})]}),e.jsxs(c,{className:"p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"활동 시간(분)"}),e.jsx("p",{className:"font-semibold",children:((L=(E=a.metrics)==null?void 0:E.activity)==null?void 0:L.activeMinutes)??"-"})]}),e.jsxs(c,{className:"p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"평균 심박수(bpm)"}),e.jsx("p",{className:"font-semibold",children:((k=(w=a.metrics)==null?void 0:w.heartRate)==null?void 0:k.avgBpm)??"-"})]}),e.jsxs(c,{className:"p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"혈압(수축/이완)"}),e.jsxs("p",{className:"font-semibold",children:[((P=(C=a.metrics)==null?void 0:C.bloodPressure)==null?void 0:P.systolic)??"-"," / ",((R=(M=a.metrics)==null?void 0:M.bloodPressure)==null?void 0:R.diastolic)??"-"]})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["데이터 출처: ",((S=a.context)==null?void 0:S.deviceType)??"-"," (",((D=a.context)==null?void 0:D.deviceId)??"-",")"]})]}):e.jsx(c,{className:"p-4 text-sm text-muted-foreground",children:"표시할 리포트가 없습니다."})})]})]})}export{te as default};
