import{c as M,j as e,i as I,y as E,v as B,p as C,r as F,x as L,B as v}from"./index-ClgdERjX.js";import{A as q,a as S,b as k}from"./avatar-BmYxBPWi.js";import{I as P}from"./input-DrzNnfUm.js";import{u as f,a as g,P as R,S as m,L as K}from"./ListItem-BGvcul8-.js";import{a as i}from"./api-DZjyy_ef.js";import{u as n}from"./common-nrhy01Dw.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]],Q=M("Mail",$),D=E("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function T({className:t,variant:r,...o}){return e.jsx("div",{className:I(D({variant:r}),t),...o})}const d={getMyBoard:async()=>{const t=await i.get("/v1/family-board");return n(t,"가족 보드를 불러오지 못했습니다.")},getMembers:async()=>{const t=await i.get("/v1/family-board/members");return n(t,"가족 멤버를 불러오지 못했습니다.")},invite:async t=>{const r=await i.post("/v1/family-board/invite",t);return n(r,"가족 초대 생성에 실패했습니다.")},accept:async t=>{const r=await i.post("/v1/family-board/accept",{inviteCode:t});return n(r,"가족 초대 수락에 실패했습니다.")},updateMemberRole:async(t,r)=>{const o=await i.put(`/v1/family-board/members/${t}/role`,{newRole:r});return n(o,"멤버 역할 변경에 실패했습니다.")},removeMember:async t=>{await i.delete(`/v1/family-board/members/${t}`)},updateSettings:async t=>{const r=await i.put("/v1/family-board/settings",{settings:t});return n(r,"보드 설정 변경에 실패했습니다.")}},c={board:["familyBoard","board"],members:["familyBoard","members"]};function V(){return f({queryKey:c.board,queryFn:d.getMyBoard})}function _(){return f({queryKey:c.members,queryFn:d.getMembers})}function z(){return g({mutationFn:t=>d.invite(t)})}function H(){const t=B();return g({mutationFn:r=>d.accept(r),onSuccess:()=>{t.invalidateQueries({queryKey:c.members}),t.invalidateQueries({queryKey:c.board})}})}function Y(){const{toast:t}=C(),{data:r,isLoading:o,isError:x}=V(),{data:b=[],isLoading:h,isError:j}=_(),w=z(),l=H(),[y,p]=F.useState(""),A=async()=>{const a=window.prompt("초대할 가족의 이메일을 입력해주세요.");if(a)try{const s=await w.mutateAsync({inviteeEmail:a,intendedRole:"VIEWER"});await navigator.clipboard.writeText(s.inviteCode),t({title:"초대 코드가 복사되었습니다.",description:`초대 코드: ${s.inviteCode}`})}catch(s){const u=s instanceof Error?s.message:"가족 초대에 실패했습니다.";t({title:"초대 실패",description:u,variant:"destructive"})}},N=async()=>{const a=y.trim();if(a)try{await l.mutateAsync(a),p(""),t({title:"참여 완료",description:"가족 보드에 참여했습니다."})}catch(s){const u=s instanceof Error?s.message:"초대 수락에 실패했습니다.";t({title:"참여 실패",description:u,variant:"destructive"})}};return o||h?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsx(L,{})}):x||j?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsx("p",{className:"text-red-500",children:"가족 정보를 불러오는 중 오류가 발생했습니다."})}):e.jsxs("div",{className:"bg-gray-50 min-h-screen",children:[e.jsx(R,{title:"가족",className:"justify-center"}),e.jsxs("main",{className:"p-4 space-y-6",children:[e.jsx(m,{title:(r==null?void 0:r.name)||"우리 가족",description:(r==null?void 0:r.description)||"가족의 건강 상태를 함께 확인해요.",action:e.jsxs(v,{onClick:A,size:"sm",withIcon:!0,children:[e.jsx(Q,{className:"w-4 h-4"}),"가족 초대"]}),children:e.jsx("div",{className:"space-y-4",children:b.map(a=>e.jsx(K,{className:"p-0 hover:bg-transparent",start:e.jsxs(q,{children:[e.jsx(S,{src:`https://i.pravatar.cc/150?u=${a.user.id}`}),e.jsx(k,{children:(a.user.name||"U").charAt(0)})]}),middle:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:a.user.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.user.email})]}),end:e.jsx(T,{variant:a.role==="ADMIN"?"default":"secondary",children:a.role==="ADMIN"?"관리자":a.role==="EDITOR"?"편집자":"뷰어"})},a.user.id))})}),e.jsx(m,{title:"초대 코드로 참여",description:"가족에게 받은 초대 코드를 입력해 참여할 수 있어요.",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{value:y,onChange:a=>p(a.target.value),placeholder:"초대 코드 입력",autoComplete:"off"}),e.jsx(v,{onClick:N,disabled:l.isPending,children:l.isPending?"처리 중...":"참여"})]})}),e.jsx(m,{title:"활동 피드",description:r!=null&&r.lastActivityAt?`최근 활동 시간: ${r.lastActivityAt}`:"가족의 최근 활동 내역입니다. (준비중)",children:e.jsx("div",{className:"rounded-md border bg-card p-4 text-sm text-muted-foreground",children:"활동 피드는 현재 BE API가 준비되는 단계입니다. (연동 시, 행동 카드/리포트/측정 데이터와 함께 제공 예정)"})})]})]})}export{Y as default};
