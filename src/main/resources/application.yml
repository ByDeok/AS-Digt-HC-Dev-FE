# =================================================================
# AS-Digt-HC Backend Application Configuration
# =================================================================
# 공통 설정 파일 - 민감정보는 환경변수 또는 프로필별 설정에서 관리
# =================================================================

spring:
  application:
    name: as-digt-hc-dev-be

  # 프로필 설정 (환경변수로 오버라이드 가능)
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:local}

  # JPA/Hibernate 공통 설정
  jpa:
    open-in-view: false  # 성능 최적화: OSIV 비활성화
    properties:
      hibernate:
        format_sql: true
        default_batch_fetch_size: 100
    hibernate:
      # ddl-auto는 프로필별로 설정
      naming:
        physical-strategy: org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy
    # JPA Auditing 설정
    show-sql: false  # 프로필별로 오버라이드 가능

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}

# =================================================================
# Redis 설정
# =================================================================
redis:
  refresh-token-prefix: ${REDIS_REFRESH_TOKEN_PREFIX:RT:}  # Refresh Token 저장 시 사용할 Redis 키 prefix

# =================================================================
# 로깅 설정
# =================================================================
logging:
  level:
    root: INFO
    vibe.digthc: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE

# =================================================================
# API 로깅/CORS 설정
# =================================================================
app:
  logging:
    api:
      enabled: ${API_LOGGING_ENABLED:true}  # API 로깅 활성화 여부
      include-headers: ${API_LOGGING_INCLUDE_HEADERS:true}  # 헤더 포함 여부
      include-body: ${API_LOGGING_INCLUDE_BODY:true}  # 본문 포함 여부
      max-body-length: ${API_LOGGING_MAX_BODY_LENGTH:1000}  # 본문 최대 길이
  cors:
    allowed-origin-patterns: ${CORS_ALLOWED_ORIGIN_PATTERNS:http://localhost:*,http://127.0.0.1:*}

# =================================================================
# 서버 설정
# =================================================================
server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: /api
    encoding:
      charset: UTF-8
      force-response: true

# =================================================================
# JWT 설정
# =================================================================
jwt:
  secret: ${JWT_SECRET}  # 필수: 환경변수로 설정 필요 (최소 256비트 이상)
  access-token-validity-in-seconds: ${JWT_ACCESS_TOKEN_VALIDITY:3600} # 1 hour (기본값)
  refresh-token-validity-in-seconds: ${JWT_REFRESH_TOKEN_VALIDITY:1209600} # 14 days (기본값)

# =================================================================
# OAuth 설정
# =================================================================
oauth:
  callback:
    url: ${OAUTH_CALLBACK_URL:http://localhost:8080/oauth/callback}  # OAuth callback URL
